{"version":3,"file":"main-dashboard.min.js","names":["createApp","SitesList","props","b","c","d","e","f","g","options","akeeba","System","getOptions","$template","sites","MAX_TIMER","maxTimer","MAX_PAGES","maxPages","PAGE_LENGTH","pageLimit","restartTimer","availableTime","countdownTimer","error","feedMeData","counter","doAjax","ajaxURL","concat","url","data","_typeof","length","resetTimer","toggleTimer","errorMessage","window","clearInterval","setInterval","timerTick","stopTimer","mounted","reloadData","bsDirective","ctx","myTooltip","effect","arg","dispose","bootstrap","Tooltip","el","placement","title","modifiers","raw","exp","get","directive","mount"],"sources":["main-dashboard.js"],"sourcesContent":["/*\n * @package   panopticon\n * @copyright Copyright (c)2023-2023 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   https://www.gnu.org/licenses/agpl-3.0.txt GNU Affero General Public License, version 3 or later\n */\n\nimport {createApp} from \"../petite-vue/petite-vue.min.js\";\n\nfunction SitesList(props)\n{\n    const options = akeeba.System.getOptions(\"panopticon.dashboard\");\n\n    return {\n        $template:      \"#sitesListTemplate\",\n        sites:          [],\n        MAX_TIMER:      props?.maxTimer ?? (options?.maxTimer ?? 90),\n        MAX_PAGES:      props?.maxPages ?? (options?.maxPages ?? 50),\n        PAGE_LENGTH:    props?.pageLimit ?? (options?.pageLimit ?? 20),\n        restartTimer:   false,\n        availableTime:  0,\n        countdownTimer: null,\n        error:          null, // The method feeding data to the view\n        feedMeData(counter)\n        {\n            // Initialise the display on the very first execution\n            if (counter === 0)\n            {\n                this.sites = [];\n            }\n\n            // I will only display up to MAX_PAGES pages at once\n            if (counter >= this.MAX_PAGES)\n            {\n                return;\n            }\n\n            akeeba.System.doAjax(\n                {\n                    ajaxURL: `${options.url}&limitstart=${this.PAGE_LENGTH * counter}&limit=${this.PAGE_LENGTH}`,\n                },\n                (data) =>\n                {\n                    this.error = null;\n\n                    // Check if we ran out of data, or we hit the upper limit of data to load.\n                    if (typeof data !== \"object\" || data.length === 0)\n                    {\n                        if (!this.countdownTimer && this.restartTimer)\n                        {\n                            this.restartTimer = false\n                            this.resetTimer()\n                            this.toggleTimer()\n                        }\n\n                        return false;\n                    }\n\n                    // Append the retrieved data to the internal list.\n                    this.sites = this.sites.concat(data)\n\n                    // Get me some more data to display!\n                    this.feedMeData(++counter)\n                },\n                (errorMessage) => {\n                    this.error = errorMessage;\n                },\n                false\n            )\n        },\n        resetTimer()\n        {\n            this.availableTime = this.MAX_TIMER;\n        },\n        toggleTimer()\n        {\n            if (this.countdownTimer)\n            {\n                window.clearInterval(this.countdownTimer);\n                this.availableTime = this.MAX_TIMER\n\n                this.countdownTimer = null;\n\n                return;\n            }\n\n            this.countdownTimer = window.setInterval(this.timerTick, 1000);\n        },\n        stopTimer()\n        {\n            if (this.countdownTimer)\n            {\n                this.toggleTimer();\n            }\n        },\n        timerTick()\n        {\n            this.availableTime -= 1;\n\n            if (this.availableTime === 0)\n            {\n                this.toggleTimer()\n                this.restartTimer = true\n                this.feedMeData(0)\n            }\n        }, // This runs when the component initialises\n        mounted()\n        {\n            this.availableTime = this.MAX_TIMER\n            this.toggleTimer()\n            this.feedMeData(0)\n        },\n        reloadData()\n        {\n            this.restartTimer = this.countdownTimer !== null\n\n            if (this.restartTimer)\n            {\n                this.toggleTimer()\n            }\n\n            this.feedMeData(0)\n        }\n    }\n}\n\nconst bsDirective = (ctx) => {\n    var myTooltip = null;\n\n    ctx.effect(() => {\n        if (ctx.arg === 'tooltip')\n        {\n            if (myTooltip)\n            {\n                myTooltip.dispose();\n                myTooltip = null;\n            }\n\n            myTooltip = new window.bootstrap.Tooltip(\n                ctx.el,\n                {\n                    placement: 'auto',\n                    title: (ctx.modifiers?.raw ?? false) ? ctx.exp : ctx.get()\n                }\n            )\n        }\n\n    })\n\n    return () => {\n        if (myTooltip)\n        {\n            myTooltip.dispose();\n            myTooltip = null;\n        }\n    }\n};\n\ncreateApp({SitesList})\n    .directive('bs', bsDirective)\n    .mount()"],"mappings":"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"}