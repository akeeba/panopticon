function _regenerator(){function b(a,b,f,g){var h=b&&b.prototype instanceof d?b:d,c=Object.create(h.prototype);return _regeneratorDefine2(c,"_invoke",function(a,b,g){function h(a,b){for(q=a,s=b,e=0;!w&&t&&!c&&e<v.length;e++){var c,f=v[e],g=p.p,h=f[2];3<a?(c=h===b)&&(s=f[(q=f[4])?5:(q=3,3)],f[4]=f[5]=j):f[0]<=g&&((c=2>a&&g<f[1])?(q=0,p.v=b,p.n=f[1]):g<h&&(c=3>a||f[0]>b||b>h)&&(f[4]=a,f[5]=b,p.n=h,q=0))}if(c||1<a)return m;throw w=!0,b}var k,q,s,t=0,v=g||[],w=!1,p={p:0,n:0,v:j,a:h,f:h.bind(j,4),d:function c(a,b){return k=a,q=0,s=j,p.n=b,m}};return function(c,d,f){if(1<t)throw TypeError("Generator is already running");for(w&&1===d&&h(d,f),q=d,s=f;(e=2>q?j:s)||!w;){k||(q?3>q?(1<q&&(p.n=-1),h(q,s)):p.n=s:p.v=s);try{if(t=2,k){if(q||(c="next"),e=k[c]){if(!(e=e.call(k,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,2>q&&(q=0)}else 1===q&&(e=k.return)&&e.call(k),2>q&&(s=TypeError("The iterator does not provide a '"+c+"' method"),q=1);k=j}else if((e=(w=0>p.n)?s:a.call(b,p))!==m)break}catch(a){k=j,q=1,s=a}finally{t=1}}return{value:e,done:w}}}(a,f,g),!0),c}function d(){}function g(){}function h(){}function i(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,h):(a.__proto__=h,_regeneratorDefine2(a,l,"GeneratorFunction")),a.prototype=Object.create(c),a}var j,e,f="function"==typeof Symbol?Symbol:{},k=f.iterator||"@@iterator",l=f.toStringTag||"@@toStringTag",m={};e=Object.getPrototypeOf;var a=[][k]?e(e([][k]())):(_regeneratorDefine2(e={},k,function(){return this}),e),c=h.prototype=d.prototype=Object.create(a);return g.prototype=h,_regeneratorDefine2(c,"constructor",h),_regeneratorDefine2(h,"constructor",g),g.displayName="GeneratorFunction",_regeneratorDefine2(h,l,"GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,l,"Generator"),_regeneratorDefine2(c,k,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function a(){return{w:b,m:i}})()}function _regeneratorDefine2(a,b,c,d){var f=Object.defineProperty;try{f({},"",{})}catch(a){f=0}_regeneratorDefine2=function e(a,b,c,d){function g(b,c){_regeneratorDefine2(a,b,function(a){return this._invoke(b,c,a)})}b?f?f(a,b,{value:c,enumerable:!d,configurable:!d,writable:!d}):a[b]=c:(g("next",0),g("throw",1),g("return",2))},_regeneratorDefine2(a,b,c,d)}function asyncGeneratorStep(b,d,f,e,g,h,a){try{var c=b[h](a),i=c.value}catch(a){return void f(a)}c.done?d(i):Promise.resolve(i).then(e,g)}function _asyncToGenerator(b){return function(){var c=this,d=arguments;return new Promise(function(e,f){function g(a){asyncGeneratorStep(i,e,f,g,h,"next",a)}function h(a){asyncGeneratorStep(i,e,f,g,h,"throw",a)}var i=b.apply(c,d);g(void 0)})}}window.akeeba=window.akeeba||{},window.akeeba.WebPush=window.akeeba.WebPush||{},function(a,b,c,d){"use strict";var e=function b(a){for(var c="=".repeat((4-a.length%4)%4),d=(a+c).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(d),f=new Uint8Array(e.length),g=0;g<e.length;++g)f[g]=e.charCodeAt(g);return f};c.subscribe=_asyncToGenerator(_regenerator().m(function d(){var f,g,h,i,j,k,l;return _regenerator().w(function(d){for(;1;)switch(d.p=d.n){case 0:if(f=b.getOptions("panopticon.webpush"),f&&f.vapidPublicKey&&f.swUrl){d.n=1;break}return d.a(2);case 1:return d.p=1,d.n=2,navigator.serviceWorker.register(f.swUrl);case 2:return g=d.v,d.n=3,g.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e(f.vapidPublicKey)});case 3:h=d.v,i=h.getKey("p256dh"),j=h.getKey("auth"),k={endpoint:h.endpoint,key_p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(i))),key_auth:btoa(String.fromCharCode.apply(null,new Uint8Array(j))),encoding:(PushManager.supportedContentEncodings||["aesgcm"])[0],user_agent:navigator.userAgent},a.ajax(f.subscribeUrl,{method:"POST",data:k,success:function d(a){try{var e=JSON.parse(a);e.success?c.updateUI(!0):alert(b.Text._("PANOPTICON_WEBPUSH_ERR_SUBSCRIBE_FAILED"))}catch(a){alert(b.Text._("PANOPTICON_WEBPUSH_ERR_SUBSCRIBE_FAILED"))}},error:function a(){alert(b.Text._("PANOPTICON_WEBPUSH_ERR_SUBSCRIBE_FAILED"))}}),d.n=5;break;case 4:d.p=4,l=d.v,"denied"===Notification.permission?alert(b.Text._("PANOPTICON_WEBPUSH_ERR_PERMISSION_DENIED")):alert(b.Text._("PANOPTICON_WEBPUSH_ERR_SUBSCRIBE_FAILED"));case 5:return d.a(2)}},d,null,[[1,4]])})),c.unsubscribe=_asyncToGenerator(_regenerator().m(function d(){var e,f,g,h,i;return _regenerator().w(function(d){for(;1;)switch(d.p=d.n){case 0:if(e=b.getOptions("panopticon.webpush"),e&&e.swUrl){d.n=1;break}return d.a(2);case 1:return d.p=1,d.n=2,navigator.serviceWorker.register(e.swUrl);case 2:return f=d.v,d.n=3,f.pushManager.getSubscription();case 3:if(g=d.v,g){d.n=4;break}return c.updateUI(!1),d.a(2);case 4:return h=g.endpoint,d.n=5,g.unsubscribe();case 5:a.ajax(e.unsubscribeUrl,{method:"POST",data:{endpoint:h},success:function a(){c.updateUI(!1)},error:function a(){c.updateUI(!1)}}),d.n=7;break;case 6:d.p=6,i=d.v,c.updateUI(!1);case 7:return d.a(2)}},d,null,[[1,6]])})),c.dismissPrompt=function(c){var e=b.getOptions("panopticon.webpush");if(e&&e.dismissUrl){a.ajax(e.dismissUrl,{method:"POST",data:{action:c},success:function a(){},error:function a(){}});var f=d.getElementById("webpush-prompt");f&&(f.style.display="none")}},c.updateUI=function(a){var c=d.getElementById("webpush-subscribe-btn"),e=d.getElementById("webpush-unsubscribe-btn"),f=d.getElementById("webpush-status-badge"),g=d.getElementById("webpush-prompt");c&&(c.style.display=a?"none":""),e&&(e.style.display=a?"":"none"),f&&(a?(f.className="badge bg-success",f.textContent=b.Text._("PANOPTICON_WEBPUSH_LBL_STATUS_ACTIVE")):(f.className="badge bg-secondary",f.textContent=b.Text._("PANOPTICON_WEBPUSH_LBL_STATUS_INACTIVE"))),g&&a&&(g.style.display="none")},c.checkCurrentSubscription=_asyncToGenerator(_regenerator().m(function a(){var e,f,g,h;return _regenerator().w(function(a){for(;1;)switch(a.p=a.n){case 0:if("serviceWorker"in navigator&&"PushManager"in window){a.n=1;break}return d.querySelectorAll(".webpush-requires-support").forEach(function(a){a.style.display="none"}),a.a(2);case 1:if(a.p=1,e=b.getOptions("panopticon.webpush"),e&&e.swUrl){a.n=2;break}return c.updateUI(!1),a.a(2);case 2:return a.n=3,navigator.serviceWorker.register(e.swUrl);case 3:return f=a.v,a.n=4,f.pushManager.getSubscription();case 4:g=a.v,c.updateUI(null!==g),a.n=6;break;case 5:a.p=5,h=a.v,c.updateUI(!1);case 6:return a.a(2)}},a,null,[[1,5]])}));var f=function a(){c.checkCurrentSubscription();var b=d.getElementById("webpush-subscribe-btn");b&&b.addEventListener("click",function(a){a.preventDefault(),c.subscribe()});var e=d.getElementById("webpush-unsubscribe-btn");e&&e.addEventListener("click",function(a){a.preventDefault(),c.unsubscribe()});var f=d.getElementById("webpush-prompt-enable");f&&f.addEventListener("click",function(a){a.preventDefault(),c.subscribe(),c.dismissPrompt("accepted")});var g=d.getElementById("webpush-prompt-remind");g&&g.addEventListener("click",function(a){a.preventDefault(),c.dismissPrompt("remind")});var h=d.getElementById("webpush-prompt-decline");h&&h.addEventListener("click",function(a){a.preventDefault(),c.dismissPrompt("declined")})};"loading"===d.readyState?d.addEventListener("DOMContentLoaded",f):f()}(akeeba.Ajax,akeeba.System,window.akeeba.WebPush,document);

//# sourceMappingURL=webpush.min.js.map