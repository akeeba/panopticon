function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(b,c){if(b){if("string"==typeof b)return _arrayLikeToArray(b,c);var a={}.toString.call(b).slice(8,-1);return"Object"===a&&b.constructor&&(a=b.constructor.name),"Map"===a||"Set"===a?Array.from(b):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(b,c):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(b,c){(null==c||c>b.length)&&(c=b.length);for(var d=0,f=Array(c);d<c;d++)f[d]=b[d];return f}window.akeeba=window.akeeba||{},window.akeeba.Passwordless=window.akeeba.Passwordless||{},function(a,b,c){"use strict";var d=function(a){alert(a)};b.initCreateCredentials=function(c){if(!("credentials"in navigator))return void d(a.Text._("PANOPTICON_PASSKEYS_ERR_NO_BROWSER_SUPPORT"));var e={resident:c?1:0};a.ajax(a.getOptions("panopticon.passkey.initURL"),{method:"POST",data:e,success:function(a){try{var c=JSON.parse(a);b.createCredentials(c)}catch(a){d(Joomla.Text._("PANOPTICON_PASSKEYS_ERR_XHR_INITCREATE"))}},error:function(a){d("".concat(a.status," ").concat(a.statusText))}})},b.createCredentials=function(e){var f=a.getOptions("panopticon.passkey.createURL"),g=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},h=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};e.challenge=Uint8Array.from(window.atob(h(e.challenge)),function(a){return a.charCodeAt(0)}),e.user.id=Uint8Array.from(window.atob(e.user.id),function(a){return a.charCodeAt(0)}),e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(h(a.id)),function(a){return a.charCodeAt(0)}),a})),navigator.credentials.create({publicKey:e}).then(function(a){var e={id:a.id,type:a.type,rawId:g(new Uint8Array(a.rawId)),response:{clientDataJSON:g(new Uint8Array(a.response.clientDataJSON)),attestationObject:g(new Uint8Array(a.response.attestationObject))}},h={data:btoa(JSON.stringify(e))};Joomla.request(f,{method:"POST",data:h,success:function(a){var d=c.querySelectorAll("#passkey-management-interface");if(d){var e=d[0];e.outerHTML=a,b.initManagement(),b.reactivateTooltips()}},onError:function(a){d("".concat(a.status," ").concat(a.statusText))}})}).catch(function(a){d(a)})},b.editLabel=function(a){var b=Joomla.getOptions("system.paths"),e="".concat(b?"".concat(b.base,"/index.php"):window.location.pathname),f=a.parentElement.parentElement,g=f.dataset.credential_id,h=f.querySelectorAll(".plg_system_passwordless-cell"),i=h[0],j=h[1],k=j.querySelectorAll("button"),l=k[0],m=k[1],n=i.querySelectorAll(".plg_system_passwordless-label")[0],o=n.innerText,p=c.createElement("input");p.className="flex-grow-1 me-1 mb-1",p.type="text",p.name="label",p.defaultValue=o;var q=c.createElement("div");q.className="d-flex flex-column flex-lg-row";var r=c.createElement("div");r.className="d-flex mt-2 mb-3 mt-lg-0 mb-lg-0";var s=c.createElement("button");s.className="btn btn-success btn-sm me-1 mb-1 flex-grow-1",s.innerText=Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_SAVE_LABEL"),s.addEventListener("click",function(){var a=p.value;if(""!==a){var b={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"savelabel",credential_id:g,new_label:a};b[Joomla.getOptions("csrf.token")]=1,Joomla.request({url:e,method:"POST",data:interpolateParameters(b),onSuccess:function(a){var b=!1;try{b=JSON.parse(a)}catch(c){b="true"===a}!0!==b&&(d(Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED")),t.click())},onError:function(a){d("".concat(Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED")," -- ").concat(a.status," ").concat(a.statusText)),t.click()}})}return n.innerText=a,l.disabled=!1,m.disabled=!1,!1},!1);var t=c.createElement("button");return t.className="btn btn-danger btn-sm me-1 mb-1 flex-grow-1",t.innerText=Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_CANCEL_LABEL"),t.addEventListener("click",function(){return n.innerText=o,l.disabled=!1,m.disabled=!1,!1},!1),r.appendChild(s),r.appendChild(t),q.appendChild(p),q.appendChild(r),n.innerHTML="",n.appendChild(q),l.disabled=!0,m.disabled=!0,!1},b.delete=function(a){var b=Joomla.getOptions("system.paths"),c="".concat(b?"".concat(b.base,"/index.php"):window.location.pathname),e=a.parentElement.parentElement,f=e.dataset.credential_id,g=e.querySelectorAll(".plg_system_passwordless-cell"),h=g[1],i=h.querySelectorAll("button"),j=i[0],k=i[1];j.disabled=!0,k.disabled=!0;var l={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"delete",credential_id:f};return l[Joomla.getOptions("csrf.token")]=1,Joomla.request({url:c,method:"POST",data:interpolateParameters(l),onSuccess:function(a){var b=!1;try{b=JSON.parse(a)}catch(c){b="true"===a}return!0===b?void e.parentElement.removeChild(e):(d(Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED")),j.disabled=!1,void(k.disabled=!1))},onError:function(a){j.disabled=!1,k.disabled=!1,d("".concat(Joomla.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED")," -- ").concat(a.status," ").concat(a.statusText))}}),!1},b.reactivateTooltips=function(){var a=Joomla.getOptions("bootstrap.tooltip");"object"===_typeof(a)&&null!==a&&Object.keys(a).forEach(function(b){var d=a[b],e={animation:!d.animation||d.animation,container:!!d.container&&d.container,delay:d.delay?d.delay:0,html:!!d.html&&d.html,selector:!!d.selector&&d.selector,trigger:d.trigger?d.trigger:"hover focus",fallbackPlacement:d.fallbackPlacement?d.fallbackPlacement:null,boundary:d.boundary?d.boundary:"clippingParents",title:d.title?d.title:"",customClass:d.customClass?d.customClass:"",sanitize:!d.sanitize||d.sanitize,sanitizeFn:d.sanitizeFn?d.sanitizeFn:null,popperConfig:d.popperConfig?d.popperConfig:null};d.placement&&(e.placement=d.placement),d.template&&(e.template=d.template),d.allowList&&(e.allowList=d.allowList);var f=Array.from(c.querySelectorAll(b));f.length&&f.map(function(a){return new window.bootstrap.Tooltip(a,e)})})},b.addOnClick=function(a){return a.preventDefault(),b.initCreateCredentials(!1),!1},b.addPasskeyOnClick=function(a){return a.preventDefault(),b.initCreateCredentials(!0),!1},b.editOnClick=function(a){return a.preventDefault(),b.editLabel(a.currentTarget),!1},b.deleteOnClick=function(a){return a.preventDefault(),b.delete(a.currentTarget),!1},b.initManagement=function(){var a=c.getElementById("plg_system_passwordless-manage-add");a&&a.addEventListener("click",b.addOnClick);var d=c.getElementById("plg_system_passwordless-manage-addresident");d&&d.addEventListener("click",b.addPasskeyOnClick);var e=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-edit"));e.length&&e.forEach(function(a){a.addEventListener("click",b.editOnClick)});var f=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-delete"));f.length&&f.forEach(function(a){a.addEventListener("click",b.deleteOnClick)})},b.initManagement();var e=function(){};"loading"===c.readyState?c.addEventListener("DOMContentLoaded",e):e()}(akeeba.System,window.akeeba.Passwordless,document);

//# sourceMappingURL=passkeys.min.js.map