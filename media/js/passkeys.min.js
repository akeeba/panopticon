function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(b,c){if(b){if("string"==typeof b)return _arrayLikeToArray(b,c);var a={}.toString.call(b).slice(8,-1);return"Object"===a&&b.constructor&&(a=b.constructor.name),"Map"===a||"Set"===a?Array.from(b):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(b,c):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(b,c){(null==c||c>b.length)&&(c=b.length);for(var d=0,f=Array(c);d<c;d++)f[d]=b[d];return f}window.akeeba=window.akeeba||{},window.akeeba.Passwordless=window.akeeba.Passwordless||{},function(a,b,c,d){"use strict";var e=function(a){alert(a)};c.initCreateCredentials=function(d){if(!("credentials"in navigator))return void e(b.Text._("PANOPTICON_PASSKEYS_ERR_NO_BROWSER_SUPPORT"));var f={resident:d?1:0};a.ajax(b.getOptions("panopticon.passkey").initURL,{method:"POST",data:f,success:function(a){try{var d=JSON.parse(a);c.createCredentials(d)}catch(a){e(b.Text._("PANOPTICON_PASSKEYS_ERR_XHR_INITCREATE"))}},error:function(a){e("".concat(a.status," ").concat(a.statusText))}})},c.createCredentials=function(f){var g=b.getOptions("panopticon.passkey").createURL,h=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},i=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};f.challenge=Uint8Array.from(window.atob(i(f.challenge)),function(a){return a.charCodeAt(0)}),f.user.id=Uint8Array.from(window.atob(f.user.id),function(a){return a.charCodeAt(0)}),f.excludeCredentials&&(f.excludeCredentials=f.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(i(a.id)),function(a){return a.charCodeAt(0)}),a})),navigator.credentials.create({publicKey:f}).then(function(b){var f={id:b.id,type:b.type,rawId:h(new Uint8Array(b.rawId)),response:{clientDataJSON:h(new Uint8Array(b.response.clientDataJSON)),attestationObject:h(new Uint8Array(b.response.attestationObject))}},i={data:btoa(JSON.stringify(f))};a.ajax(g,{method:"POST",data:i,success:function(a){var b=d.querySelectorAll("#passkey-management-interface");if(b){var e=b[0];e.outerHTML=a,c.initManagement()}},error:function(a){e("".concat(a.status," ").concat(a.statusText))}})}).catch(function(a){e(a)})},c.editLabel=function(c){var f=b.getOptions("panopticon.passkey").saveLabelURL,g=c.parentElement.parentElement,h=g.dataset.credential_id,i=g.querySelectorAll(".passkey-cell"),j=i[0],k=i[1],l=k.querySelectorAll("button"),m=l[0],n=l[1],o=j.querySelectorAll(".passkey-label")[0],p=o.innerText,q=d.createElement("input");q.className="flex-grow-1 me-1 mb-1",q.type="text",q.name="label",q.defaultValue=p;var r=d.createElement("div");r.className="d-flex flex-column flex-lg-row";var s=d.createElement("div");s.className="d-flex mt-2 mb-3 mt-lg-0 mb-lg-0";var t=d.createElement("button");t.className="btn btn-success btn-sm me-1 mb-1 flex-grow-1",t.innerText=b.Text._("PANOPTICON_PASSKEYS_MANAGE_BTN_SAVE_LABEL"),t.addEventListener("click",function(){var c=q.value;if(""!==c){a.ajax(f,{method:"POST",data:{credential_id:h,new_label:c},success:function(a){var c=!1;try{c=JSON.parse(a)}catch(b){c="true"===a}!0!==c&&(e(b.Text._("PANOPTICON_PASSKEYS_ERR_LABEL_NOT_SAVED")),u.click())},error:function(a){e("".concat(b.Text._("PANOPTICON_PASSKEYS_ERR_LABEL_NOT_SAVED")," -- ").concat(a.status," ").concat(a.statusText)),u.click()}})}return o.innerText=c,m.disabled=!1,n.disabled=!1,!1},!1);var u=d.createElement("button");return u.className="btn btn-danger btn-sm me-1 mb-1 flex-grow-1",u.innerText=b.Text._("PANOPTICON_PASSKEYS_MANAGE_BTN_CANCEL_LABEL"),u.addEventListener("click",function(){return o.innerText=p,m.disabled=!1,n.disabled=!1,!1},!1),s.appendChild(t),s.appendChild(u),r.appendChild(q),r.appendChild(s),o.innerHTML="",o.appendChild(r),m.disabled=!0,n.disabled=!0,!1},c.delete=function(c){var d=b.getOptions("panopticon.passkey").deleteURL,f=c.parentElement.parentElement,g=f.dataset.credential_id,h=f.querySelectorAll(".passkey-cell"),i=h[1],j=i.querySelectorAll("button"),k=j[0],l=j[1];k.disabled=!0,l.disabled=!0;return a.ajax(d,{method:"POST",data:{credential_id:g},success:function(a){var c=!1;try{c=JSON.parse(a)}catch(b){c="true"===a}return!0===c?void f.parentElement.removeChild(f):(e(b.Text._("PANOPTICON_PASSKEYS_ERR_NOT_DELETED")),k.disabled=!1,void(l.disabled=!1))},error:function(a){k.disabled=!1,l.disabled=!1,e("".concat(b.Text._("PANOPTICON_PASSKEYS_ERR_NOT_DELETED")," -- ").concat(a.status," ").concat(a.statusText))}}),!1},c.addOnClick=function(a){return a.preventDefault(),c.initCreateCredentials(!1),!1},c.addPasskeyOnClick=function(a){return a.preventDefault(),c.initCreateCredentials(!0),!1},c.editOnClick=function(a){return a.preventDefault(),c.editLabel(a.currentTarget),!1},c.deleteOnClick=function(a){return a.preventDefault(),c.delete(a.currentTarget),!1},c.initManagement=function(){var a=d.getElementById("passkey-manage-add");a&&a.addEventListener("click",c.addOnClick);var b=d.getElementById("passkey-manage-addresident");b&&b.addEventListener("click",c.addPasskeyOnClick);var e=[].slice.call(d.querySelectorAll(".passkey-manage-edit"));e.length&&e.forEach(function(a){a.addEventListener("click",c.editOnClick)});var f=[].slice.call(d.querySelectorAll(".passkey-manage-delete"));f.length&&f.forEach(function(a){a.addEventListener("click",c.deleteOnClick)})};var f=function(){c.initManagement()};"loading"===d.readyState?d.addEventListener("DOMContentLoaded",f):f()}(akeeba.Ajax,akeeba.System,window.akeeba.Passwordless,document);

//# sourceMappingURL=passkeys.min.js.map