{"version":3,"file":"apitokens.min.js","names":["window","akeeba","ApiTokens","Ajax","System","document","options","ajaxPost","url","data","onSuccess","onError","token","csrfToken","ajax","method","success","responseText","result","JSON","parse","e","error","xhr","create","descField","getElementById","description","value","trim","createUrl","alert","message","alertEl","valueEl","classList","remove","location","reload","toggle","id","toggleUrl","confirm","Text","_","removeUrl","row","querySelector","showToken","group","contains","tokenUrl","input","add","onDOMContentLoaded","getOptions","btnCreate","addEventListener","btnCopyNew","navigator","clipboard","writeText","querySelectorAll","forEach","btn","parseInt","dataset","closest","readyState"],"sources":["apitokens.js"],"sourcesContent":["/**\n * @package   panopticon\n * @copyright Copyright (c)2023-2026 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   https://www.gnu.org/licenses/agpl-3.0.txt GNU Affero General Public License, version 3 or later\n */\n\nwindow.akeeba            = window.akeeba || {};\nwindow.akeeba.ApiTokens  = window.akeeba.ApiTokens || {};\n\n((Ajax, System, ApiTokens, document) =>\n{\n    \"use strict\";\n\n    let options = {};\n\n    /**\n     * Make an AJAX POST request to a controller task.\n     *\n     * @param {string} url     The URL to call.\n     * @param {Object} data    POST data (key-value pairs).\n     * @param {Function} onSuccess  Callback on success, receives parsed response.\n     * @param {Function} onError    Callback on error.\n     */\n    const ajaxPost = (url, data, onSuccess, onError) =>\n    {\n        data.token = options.csrfToken;\n\n        Ajax.ajax(\n            url,\n            {\n                method: \"POST\",\n                data: data,\n                success: (responseText) =>\n                {\n                    try\n                    {\n                        const result = JSON.parse(responseText);\n                        onSuccess(result);\n                    }\n                    catch (e)\n                    {\n                        if (onError)\n                        {\n                            onError(e);\n                        }\n                    }\n                },\n                error: (xhr) =>\n                {\n                    if (onError)\n                    {\n                        onError(xhr);\n                    }\n                },\n            }\n        );\n    };\n\n    /**\n     * Create a new API token.\n     */\n    ApiTokens.create = () =>\n    {\n        const descField = document.getElementById(\"newTokenDescription\");\n        const description = descField ? descField.value.trim() : \"\";\n\n        ajaxPost(\n            options.createUrl,\n            {description: description},\n            (result) =>\n            {\n                if (!result.success)\n                {\n                    alert(result.message || \"Failed to create token\");\n\n                    return;\n                }\n\n                // Show the new token value\n                const alertEl = document.getElementById(\"newTokenAlert\");\n                const valueEl = document.getElementById(\"newTokenValue\");\n\n                if (alertEl && valueEl)\n                {\n                    valueEl.value = result.token;\n                    alertEl.classList.remove(\"d-none\");\n                }\n\n                // Clear the description field\n                if (descField)\n                {\n                    descField.value = \"\";\n                }\n\n                // Reload the page to show the updated table\n                window.location.reload();\n            },\n            () =>\n            {\n                alert(\"Failed to create token\");\n            }\n        );\n    };\n\n    /**\n     * Toggle a token's enabled/disabled status.\n     *\n     * @param {number} id  The token ID.\n     */\n    ApiTokens.toggle = (id) =>\n    {\n        ajaxPost(\n            options.toggleUrl,\n            {id: id},\n            (result) =>\n            {\n                if (!result.success)\n                {\n                    alert(result.message || \"Failed to toggle token\");\n\n                    return;\n                }\n\n                window.location.reload();\n            },\n            () =>\n            {\n                alert(\"Failed to toggle token\");\n            }\n        );\n    };\n\n    /**\n     * Delete a token.\n     *\n     * @param {number} id  The token ID.\n     */\n    ApiTokens.remove = (id) =>\n    {\n        if (!confirm(System.Text._(\"PANOPTICON_APITOKENS_BTN_CONFIRM_DELETE\")))\n        {\n            return;\n        }\n\n        ajaxPost(\n            options.removeUrl,\n            {id: id},\n            (result) =>\n            {\n                if (!result.success)\n                {\n                    alert(result.message || \"Failed to delete token\");\n\n                    return;\n                }\n\n                // Remove the row from the table\n                const row = document.querySelector(\"tr[data-token-id=\\\"\" + id + \"\\\"]\");\n\n                if (row)\n                {\n                    row.remove();\n                }\n            },\n            () =>\n            {\n                alert(\"Failed to delete token\");\n            }\n        );\n    };\n\n    /**\n     * Show/hide a token's value.\n     *\n     * @param {number} id  The token ID.\n     */\n    ApiTokens.showToken = (id) =>\n    {\n        const group = document.querySelector(\".token-value-group[data-id=\\\"\" + id + \"\\\"]\");\n\n        if (!group)\n        {\n            return;\n        }\n\n        // If already visible, toggle it off\n        if (!group.classList.contains(\"d-none\"))\n        {\n            group.classList.add(\"d-none\");\n\n            return;\n        }\n\n        ajaxPost(\n            options.tokenUrl,\n            {id: id},\n            (result) =>\n            {\n                if (!result.success)\n                {\n                    alert(result.message || \"Failed to get token value\");\n\n                    return;\n                }\n\n                const input = group.querySelector(\".token-value-input\");\n\n                if (input)\n                {\n                    input.value = result.token;\n                }\n\n                group.classList.remove(\"d-none\");\n            },\n            () =>\n            {\n                alert(\"Failed to get token value\");\n            }\n        );\n    };\n\n    /**\n     * Initialise event listeners on DOM ready.\n     */\n    const onDOMContentLoaded = () =>\n    {\n        options = System.getOptions(\"panopticon.apitokens\");\n\n        if (!options)\n        {\n            return;\n        }\n\n        // Create button\n        const btnCreate = document.getElementById(\"btnCreateToken\");\n\n        if (btnCreate)\n        {\n            btnCreate.addEventListener(\"click\", ApiTokens.create);\n        }\n\n        // Copy new token button\n        const btnCopyNew = document.getElementById(\"btnCopyNewToken\");\n\n        if (btnCopyNew)\n        {\n            btnCopyNew.addEventListener(\"click\", () =>\n            {\n                const input = document.getElementById(\"newTokenValue\");\n\n                if (input)\n                {\n                    navigator.clipboard.writeText(input.value);\n                }\n            });\n        }\n\n        // Toggle buttons\n        document.querySelectorAll(\".btn-toggle-token\").forEach((btn) =>\n        {\n            btn.addEventListener(\"click\", () =>\n            {\n                ApiTokens.toggle(parseInt(btn.dataset.id, 10));\n            });\n        });\n\n        // Show token buttons\n        document.querySelectorAll(\".btn-show-token\").forEach((btn) =>\n        {\n            btn.addEventListener(\"click\", () =>\n            {\n                ApiTokens.showToken(parseInt(btn.dataset.id, 10));\n            });\n        });\n\n        // Delete buttons\n        document.querySelectorAll(\".btn-delete-token\").forEach((btn) =>\n        {\n            btn.addEventListener(\"click\", () =>\n            {\n                ApiTokens.remove(parseInt(btn.dataset.id, 10));\n            });\n        });\n\n        // Copy token value buttons\n        document.querySelectorAll(\".btn-copy-token\").forEach((btn) =>\n        {\n            btn.addEventListener(\"click\", () =>\n            {\n                const input = btn.closest(\".token-value-group\").querySelector(\".token-value-input\");\n\n                if (input)\n                {\n                    navigator.clipboard.writeText(input.value);\n                }\n            });\n        });\n    };\n\n    if (document.readyState === \"loading\")\n    {\n        document.addEventListener(\"DOMContentLoaded\", onDOMContentLoaded);\n    }\n    else\n    {\n        onDOMContentLoaded();\n    }\n})(akeeba.Ajax, akeeba.System, window.akeeba.ApiTokens, document);\n"],"mappings":"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","ignoreList":[]}