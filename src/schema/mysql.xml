<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ @package   panopticon
  ~ @copyright Copyright (c)2023-2023 Nicholas K. Dionysopoulos / Akeeba Ltd
  ~ @license   https://www.gnu.org/licenses/agpl-3.0.txt GNU Affero General Public License, version 3 or later
  -->
<schema>
    <meta>
        <drivers>
            <driver>mysqli</driver>
            <driver>pdomysql</driver>
        </drivers>
    </meta>

    <sql>
        <action table="#__akeeba_common" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__akeeba_common`
(
    `key`   VARCHAR(255) NOT NULL,
    `value` LONGTEXT     NOT NULL,
    PRIMARY KEY (`key`(64))
)
    DEFAULT COLLATE utf8mb4_unicode_ci
    ENGINE = InnoDB;
            ]]></query>
        </action>

        <action table="#__users" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__users`
(
    `id`         BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
    `username`   VARCHAR(255)        NOT NULL,
    `name`       VARCHAR(255)        NOT NULL,
    `email`      VARCHAR(255)        NOT NULL,
    `password`   VARCHAR(255)        NOT NULL,
    `parameters` LONGTEXT,
    PRIMARY KEY (`id`)
)
    DEFAULT COLLATE utf8mb4_unicode_ci
    ENGINE = InnoDB;
]]></query>
        </action>

        <action table="#__sites" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__sites`
(
    `id`          SERIAL,
    `name`        VARCHAR(255)     NOT NULL,
    `url`         VARCHAR(1024)    NOT NULL,
    `enabled`     TINYINT UNSIGNED NOT NULL DEFAULT 1,
    `created_on`  DATETIME         NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `created_by`  BIGINT UNSIGNED  NOT NULL,
    `modified_on` DATETIME         NULL,
    `modified_by` BIGINT UNSIGNED  NULL,
    `locked_on`   DATETIME         NULL,
    `locked_by`   BIGINT UNSIGNED  NULL,
    `config`      JSON,
    `notes`       LONGTEXT         NULL,
    FOREIGN KEY `#__sites_users_created` (`created_by`) REFERENCES `#__users` (`id`) ON DELETE CASCADE,
    FOREIGN KEY `#__sites_users_modified` (`modified_by`) REFERENCES `#__users` (`id`) ON DELETE SET NULL,
    FOREIGN KEY `#__sites_users_locked` (`locked_by`) REFERENCES `#__users` (`id`) ON DELETE SET NULL,
    PRIMARY KEY (`id`),
    KEY `#__sites_name` (`name`(50))
)
    DEFAULT COLLATE utf8mb4_unicode_ci
    ENGINE = InnoDB;
            ]]></query>
        </action>

        <action table="#__sites" canfail="1">
            <condition type="missing">notes</condition>
            <query><![CDATA[
ALTER TABLE `#__sites` ADD COLUMN `notes` LONGTEXT NULL AFTER `config`;
]]></query>
        </action>

        <action table="#__sites" canfail="1">
            <condition type="index" operator="not"><![CDATA[#__sites_name]]></condition>
            <query><![CDATA[
ALTER TABLE `#__sites`
ADD INDEX `#__sites_name` (`name`(50));
]]></query>
        </action>

        <action table="#__tasks" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__tasks`
(
    `id`              SERIAL,
    `site_id`         BIGINT UNSIGNED NULL DEFAULT NULL,
    `type`            VARCHAR(255)    NOT NULL,
    `params`          JSON,
    `storage`         JSON,
    `cron_expression` VARCHAR(255)    NOT NULL DEFAULT '@daily',
    `enabled`         TINYINT         NOT NULL DEFAULT 1,
    `last_exit_code`  INT             NOT NULL DEFAULT 0,
    `last_execution`  DATETIME        NULL,
    `last_run_end`    DATETIME        NULL,
    `next_execution`  DATETIME        NOT NULL DEFAULT '2000-01-01 00:00:00',
    `times_executed`  INT UNSIGNED    NOT NULL DEFAULT 0,
    `times_failed`    INT UNSIGNED    NOT NULL DEFAULT 0,
    `locked`          DATETIME        NULL,
    `priority`        INT             NOT NULL DEFAULT 0,
    FOREIGN KEY `#__tasks_sites` (`site_id`) REFERENCES `#__sites` (`id`) ON DELETE CASCADE,
    PRIMARY KEY (`id`)
)
    DEFAULT COLLATE utf8mb4_unicode_ci
    ENGINE = InnoDB;
            ]]></query>
        </action>

        <action table="#__tasks" canfail="1">
            <condition type="type" value="params" coltype="longtext" />
            <query><![CDATA[
ALTER TABLE `#__tasks`
    MODIFY COLUMN `params` JSON;
]]></query>
        </action>

        <action table="#__tasks" canfail="1">
            <condition type="type" value="storage" coltype="longtext" />
            <query><![CDATA[
ALTER TABLE `#__tasks`
    MODIFY COLUMN `storage` JSON;
]]></query>
        </action>

        <action table="#__queue" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__queue`
(
    `id`    SERIAL,
    `time`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `item`  JSON,
    PRIMARY KEY (`id`)
) DEFAULT COLLATE utf8mb4_unicode_ci
  ENGINE = InnoDB;
            ]]></query>
        </action>

        <action table="#__mailtemplates" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__mailtemplates`
(
    `id`    SERIAL,
    `type`  VARCHAR(255) NOT NULL,
    `language` VARCHAR(50) NOT NULL DEFAULT '*',
    `subject` VARCHAR(255) NOT NULL,
    `html` LONGTEXT,
    `plaintext` LONGTEXT,
    INDEX `#__mailtemplates_type` (`type`(60)),
    PRIMARY KEY (`id`)
) DEFAULT COLLATE utf8mb4_unicode_ci
  ENGINE = InnoDB;
            ]]></query>
        </action>

        <action table="#__mfa" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__mfa`
(
    `id`         SERIAL,
    `user_id`    BIGINT UNSIGNED NOT NULL,
    `title`      VARCHAR(255)    NOT NULL,
    `method`     VARCHAR(100)    NOT NULL,
    `default`    TINYINT(1)      NOT NULL DEFAULT 0,
    `options`    LONGTEXT        null,
    `created_on` DATETIME        NULL,
    `last_used`  DATETIME        NULL,
    INDEX `#__mfa_user` (`user_id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  DEFAULT COLLATE = utf8mb4_unicode_ci;
            ]]></query>
        </action>

        <action table="#__groups" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__groups`
(
    `id`         SERIAL,
    `title`      VARCHAR(255) NOT NULL,
    `privileges` JSON         NOT NULL DEFAULT ('{}')
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  DEFAULT COLLATE = utf8mb4_unicode_ci;
            ]]></query>
        </action>

        <action table="#__reports" canfail="0">
            <condition type="missing" value=""/>
            <query><![CDATA[
CREATE TABLE IF NOT EXISTS `#__reports` (
    `id` BIGINT UNSIGNED AUTO_INCREMENT,
    `site_id` BIGINT UNSIGNED NOT NULL,
    `created_on` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `created_by` BIGINT UNSIGNED NOT NULL DEFAULT '0',
    `action` ENUM('core_update_found','core_update_installed','ext_update_found','ext_update_installed','backup','filescanner','site_action','misc_action') NOT NULL DEFAULT 'misc_action',
    `context` JSON NOT NULL,
    UNIQUE KEY `id` (`id`),
    KEY `#__report_site_acton_index` (`site_id`,`action`),
    KEY `#__report_site_index` (`site_id`),
    CONSTRAINT `#__report_sites_fk` FOREIGN KEY (`site_id`) REFERENCES `#__sites` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci;
            ]]></query>
        </action>

        <!-- Install the common CSS -->
        <action table="#__akeeba_common" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT COUNT(*) FROM `#__akeeba_common` WHERE `key` = 'mail.common_css';
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__akeeba_common` (`key`, `value`) VALUES ('mail.common_css',':root {\r\n    color-scheme: light dark;\r\n}\r\n\r\n/*Reset styles*/\r\nbody {\r\n    font-family: \'Helvetica Neue\', Helvetica, Arial, sans-serif;\r\n    font-size: 12pt;\r\n    margin: 0;\r\n    padding: 0;\r\n    color: #514f4f;\r\n}\r\n\r\n.akemail-outer-wrapper {\r\n    background: #40b5b8;\r\n}\r\n\r\n.akemail-outer-wrapper table {\r\n    width: 100%;\r\n    max-width: 960px;\r\n    margin: 0 auto;\r\n}\r\n\r\n.akemail-wrapper {\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 1em 0;\r\n}\r\n\r\n.akemail-container {\r\n    background-color: #fff;\r\n    color: #514f4f;\r\n    text-align: left;\r\n    box-shadow: black 0 0 8px;\r\n}\r\n\r\n.akemail-logo {\r\n    background-color: #efefef;\r\n    text-align: right;\r\n    padding: 1em 1em;\r\n    min-height: 40px;\r\n}\r\n\r\n.akemail-logo a {\r\n    border: none;\r\n    text-decoration: none;\r\n}\r\n\r\n.akemail-logo a img {\r\n    max-height: 50px;\r\n    max-width: 200px;\r\n}\r\n\r\n.akemail-hello {\r\n    font-size: 13pt;\r\n    color: #38b5b8;\r\n    padding: 0.5em 1em;\r\n}\r\n\r\n.akemail-main-topic {\r\n    text-align: center;\r\n    font-size: 13pt;\r\n    font-weight: bold;\r\n    color: #e43535;\r\n    padding: 0.5em 1em;\r\n}\r\n\r\n.akemail-message {\r\n    padding: 0.5em 1em;\r\n}\r\n\r\n.akemail-message a {\r\n    color: #38b5b8;\r\n    text-decoration: underline;\r\n}\r\n\r\n.akemail-product-buttons {\r\n    text-align: center;\r\n}\r\n\r\n.akemail-message h4 {\r\n    color: #38b5b8;\r\n    font-size: 13pt;\r\n    border-bottom: thin solid #38b5b8;\r\n}\r\n\r\na.akemail-button {\r\n    display: inline-block;\r\n    text-align: center;\r\n    padding: 20px 55px;\r\n    color: #70a230;\r\n    border: 5px solid #40b5b8;\r\n    margin: 5px;\r\n    box-sizing: border-box;\r\n    background-color: #eaeaea;\r\n    text-decoration: none;\r\n    font-weight: bold;\r\n}\r\n\r\na.akemail-button:hover {\r\n    background-color: #d9d9d9;\r\n}\r\n\r\na.akemail-button img {\r\n    display: block;\r\n    width: 50px;\r\n    margin: 0 auto;\r\n}\r\n\r\n.akemail-announcement-box {\r\n    background: #e43535;\r\n    padding: 0 1em;\r\n    margin: 0 2em;\r\n    color: #fff;\r\n    border-radius: 0.25em;\r\n    border: thin solid #952b2b;\r\n}\r\n\r\n.akemail-announcement-box h3 {\r\n    font-weight: bold;\r\n    font-size: 13pt;\r\n    font-style: italic;\r\n    padding: 0;\r\n    margin: 1em 0 0.5em;\r\n    border-bottom: thin solid #efefef;\r\n}\r\n\r\n.akemail-announcement-note {\r\n    color: #7a7a7a;\r\n    font-size: 10pt;\r\n    line-height: 1.1em;\r\n    margin: 1em 3em 0;\r\n}\r\n\r\n.akemail-announcement-visitlink {\r\n    margin: 1em 1em 0;\r\n}\r\n\r\n.akemail-announcement-visitlink a {\r\n    color: #38b5b8;\r\n    text-decoration: underline;\r\n}\r\n\r\n.akemail-outro {\r\n    color: #514f4f;\r\n    padding: 0 1em 1em;\r\n}\r\n\r\n.akemail-footer {\r\n    display: block;\r\n    text-align: right;\r\n    background: #514f4f;\r\n    color: #fff;\r\n    font-size: 10pt;\r\n    padding: 1px 2em;\r\n}\r\n\r\n.akemail-footer-sitelink a {\r\n    float: left;\r\n    color: #ffffff;\r\n    text-decoration: none;\r\n    border: none;\r\n}\r\n\r\n.akemail-footer-follow img {\r\n    border: none;\r\n    text-decoration: none;\r\n    max-width: 100%;\r\n}\r\n\r\n.akemail-legalinfo {\r\n    text-align: center;\r\n    width: 100%;\r\n    max-width: 960px;\r\n    color: #efefef;\r\n    font-size: 9pt;\r\n    font-weight: normal;\r\n    background-color: rgba(0, 0, 0, 0.2);\r\n    margin: 2em auto;\r\n    padding: 0.5em 0;\r\n}\r\n\r\n.akemail-legalinfo a {\r\n    color: white;\r\n    font-weight: bold;\r\n    text-decoration: underline;\r\n    border: none;\r\n}\r\n\r\n.akemail-legalinfo p {\r\n    margin: 0.3em 1em 0;\r\n}\r\n\r\n@media (prefers-color-scheme: dark) {\r\n    .akemail-outer-wrapper {\r\n        background-color: #274b4e;\r\n    }\r\n\r\n    .akemail-container {\r\n        background-color: #383636;\r\n        color: #efefef;\r\n    }\r\n\r\n    .akemail-logo {\r\n        background-color: #242222;\r\n    }\r\n\r\n    .akemail-main-topic {\r\n        color: #f73535;\r\n    }\r\n\r\n    .akemail-announcement-box {\r\n        background: #712121;\r\n        color: #efefef;\r\n    }\r\n\r\n    .akemail-announcement-box h3 {\r\n        border-bottom: thin solid #f73535;\r\n    }\r\n\r\n    .akemail-announcement-note {\r\n        color: #adadad;\r\n    }\r\n\r\n    .akemail-outro {\r\n        color: #3ea1a4;\r\n    }\r\n\r\n    .akemail-footer {\r\n        background-color: #242222;\r\n    }\r\n}');
]]></query>
        </action>

        <!-- Install mail template: joomlaupdate_found -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'joomlaupdate_found') x;
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates`
(`type`,`language`,`subject`,`html`,`plaintext`) VALUES
('joomlaupdate_found','*','⚠️ Joomla!™ [NEW_VERSION] is available on “[SITE_NAME]”','<div class=\"akemail-outer-wrapper\">\r\n<table>\r\n<tbody>\r\n<tr>\r\n<td width=\"10%\">&nbsp;</td>\r\n<td>\r\n<div class=\"akemail-wrapper\">\r\n<div class=\"akemail-container\"><!-- Logo Header -->\r\n<div class=\"akemail-logo\"><a href=\"[URL]\">&nbsp;<img src=\"[URL]/media/images/logo_bw.svg\" alt=\"Panopticon &mdash; Site Monitoring\">&nbsp;</a></div>\r\n<!-- Hello -->\r\n<div class=\"akemail-hello\">\r\n<p>Hello,</p>\r\n</div>\r\n<!-- Main-Topic -->\r\n<div class=\"akemail-main-topic\">\r\n<p>Joomla!&trade; [NEW_VERSION] is available on &ldquo;[SITE_NAME]&rdquo;</p>\r\n</div>\r\n<!-- Message -->\r\n<div class=\"akemail-message\">\r\n<p>Joomla! version [NEW_VERSION] is now available for installation on your site &ldquo;<a href=\"[SITE_URL]\">[SITE_NAME]</a>&rdquo;. Your site is currently running the older version [OLD_VERSION].</p>\r\n</div>\r\n<!-- Area Offer/Announcement -->\r\n<div class=\"akemail-announcement\">\r\n<div class=\"akemail-announcement-box\">\r\n<h3>Action required</h3>\r\n<p>The new version will <strong>NOT</strong> be installed automatically. You will have to install it yourself.</p>\r\n</div>\r\n<p class=\"akemail-announcement-note\"><em>Note</em>: Akeeba Panopticon can be configured to install new Joomla! versions automatically.</p>\r\n<p class=\"akemail-announcement-visitlink\">You can install the new Joomla! version either from your site\'s administrator page, or through the main control panel of <a href=\"[URL]\">your Akeeba Panopticon installation</a>.</p>\r\n</div>\r\n<!-- Bye, Bye -->\r\n<div class=\"akemail-outro\">\r\n<p>Have a great day!</p>\r\n</div>\r\n<!-- Footer -->\r\n<div class=\"akemail-footer\">\r\n<p class=\"akemail-footer-sitelink\">&nbsp;<a href=\"[URL]\">Panopticon &mdash; Site Monitoring</a></p>\r\n</div>\r\n</div>\r\n<!-- Legal info -->\r\n<div class=\"akemail-legalinfo\">\r\n<p>This is an automated email. Please do not reply to it.</p>\r\n</div>\r\n</div>\r\n</td>\r\n<td width=\"10%\">&nbsp;</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div>','Hello,\r\n\r\n\r\nJoomla!™ [NEW_VERSION] is available on “[SITE_NAME]”\r\n\r\n\r\nJoomla! version [NEW_VERSION] is now available for installation on\r\nyour site “[SITE_NAME] [/[SITE_URL]]”. Your site is currently\r\nrunning the older version [OLD_VERSION].\r\n\r\n\r\n==============================================================================\r\n! ! ! ! !  ACTION REQUIRED  ! ! ! ! !\r\n==============================================================================\r\n\r\nThe new version will NOT be installed automatically. You will have to\r\ninstall it yourself.\r\n\r\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nNote: Akeeba Panopticon can be configured to install new Joomla!\r\nversions automatically.\r\n\r\n==============================================================================\r\n\r\n\r\nYou can install the new Joomla! version either from your site\'s\r\nadministrator page, or through the main control panel of your Akeeba\r\nPanopticon installation ([URL]).\r\n\r\nHave a great day!\r\n\r\n------------------------------------------------------------------------------\r\n\r\nThis email was sent by the Panopticon installation on [URL].\r\nThis is an automated email. Please do not reply to it.');
]]></query>
        </action>

        <!-- Install mail template: joomlaupdate_installed -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'joomlaupdate_installed') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates`
(`type`,`language`,`subject`,`html`,`plaintext`) VALUES
('joomlaupdate_installed','*','Joomla!™ has been updated to [NEW_VERSION] on “[SITE_NAME]”','<div class=\"akemail-outer-wrapper\">\r\n<table>\r\n<tbody>\r\n<tr>\r\n<td width=\"10%\">&nbsp;</td>\r\n<td>\r\n<div class=\"akemail-wrapper\">\r\n<div class=\"akemail-container\"><!-- Logo Header -->\r\n<div class=\"akemail-logo\"><a href=\"[URL]\">&nbsp;<img src=\"[URL]/media/images/logo_bw.svg\" alt=\"Panopticon &mdash; Site Monitoring\">&nbsp;</a></div>\r\n<!-- Hello -->\r\n<div class=\"akemail-hello\">\r\n<p>Hello,</p>\r\n</div>\r\n<!-- Main-Topic -->\r\n<div class=\"akemail-main-topic\">\r\n<p>Joomla!&trade; has been updated to [NEW_VERSION] on &ldquo;[SITE_NAME]&rdquo;</p>\r\n</div>\r\n<!-- Message -->\r\n<div class=\"akemail-message\">\r\n<p>Joomla! version [NEW_VERSION] was installed on your site &ldquo;<a href=\"[SITE_URL]\">[SITE_NAME]</a>&rdquo;. Before this change, your site was running the older version [OLD_VERSION].</p>\r\n<p>No further action is required on your part.</p>\r\n</div>\r\n<!-- Area Offer/Announcement --><!-- Bye, Bye -->\r\n<div class=\"akemail-outro\">\r\n<p>Have a great day!</p>\r\n</div>\r\n<!-- Footer -->\r\n<div class=\"akemail-footer\">\r\n<p class=\"akemail-footer-sitelink\">&nbsp;<a href=\"[URL]\">Panopticon &mdash; Site Monitoring</a></p>\r\n</div>\r\n</div>\r\n<!-- Legal info -->\r\n<div class=\"akemail-legalinfo\">\r\n<p>This is an automated email. Please do not reply to it.</p>\r\n</div>\r\n</div>\r\n</td>\r\n<td width=\"10%\">&nbsp;</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div>','Hello,\r\n\r\n\r\nJoomla!™ has been updated to [NEW_VERSION] on “[SITE_NAME]”\r\n\r\nJoomla! version [NEW_VERSION] was installed on your site “[SITE_NAME]”. Before\r\nthis change, your site was running the older version [OLD_VERSION].\r\n\r\nNo further action is required on your part.\r\n\r\n\r\nHave a great day!\r\n\r\n------------------------------------------------------------------------------\r\n\r\nThis email was sent by the Panopticon installation on [URL].\r\nThis is an automated email. Please do not reply to it.');
]]></query>
        </action>

        <!-- Install mail template: joomlaupdate_failed -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'joomlaupdate_failed') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates`
(`type`,`language`,`subject`,`html`,`plaintext`) VALUES
('joomlaupdate_failed','*','🚨 Unable to upgrade “[SITE_NAME]” to Joomla!™ [NEW_VERSION]','<div class=\"akemail-outer-wrapper\">\r\n<table>\r\n<tbody>\r\n<tr>\r\n<td width=\"10%\">&nbsp;</td>\r\n<td>\r\n<div class=\"akemail-wrapper\">\r\n<div class=\"akemail-container\"><!-- Logo Header -->\r\n<div class=\"akemail-logo\"><a href=\"[URL]\">&nbsp;<img src=\"[URL]/media/images/logo_bw.svg\" alt=\"Panopticon &mdash; Site Monitoring\">&nbsp;</a></div>\r\n<!-- Hello -->\r\n<div class=\"akemail-hello\">\r\n<p>Hello,</p>\r\n</div>\r\n<!-- Main-Topic -->\r\n<div class=\"akemail-main-topic\">\r\n<p>Unable to upgrade &ldquo;[SITE_NAME]&rdquo; to Joomla!&trade; [NEW_VERSION]</p>\r\n</div>\r\n<!-- Message -->\r\n<div class=\"akemail-message\">\r\n<p>Panopticon was unable to install the new Joomla! version [NEW_VERSION] on your site &ldquo;<a href=\"[SITE_URL]\">[SITE_NAME]</a>&rdquo;. The error received is as follows:</p>\r\n<p>[MESSAGE]</p>\r\n</div>\r\n<!-- Area Offer/Announcement -->\r\n<div class=\"akemail-announcement\">\r\n<div class=\"akemail-announcement-box\">\r\n<h3>Action required</h3>\r\n<p>The new version will <strong>NOT</strong> be installed automatically. You will have to install it yourself.</p>\r\n</div>\r\n<p class=\"akemail-announcement-visitlink\">You can install the new Joomla! version either from your site\'s administrator page, or through the main control panel of <a href=\"[URL]\">your Akeeba Panopticon installation</a>.</p>\r\n</div>\r\n<!-- Bye, Bye -->\r\n<div class=\"akemail-outro\">\r\n<p>Have a great day!</p>\r\n</div>\r\n<!-- Footer -->\r\n<div class=\"akemail-footer\">\r\n<p class=\"akemail-footer-sitelink\">&nbsp;<a href=\"[URL]\">Panopticon &mdash; Site Monitoring</a></p>\r\n</div>\r\n</div>\r\n<!-- Legal info -->\r\n<div class=\"akemail-legalinfo\">\r\n<p>This is an automated email. Please do not reply to it.</p>\r\n</div>\r\n</div>\r\n</td>\r\n<td width=\"10%\">&nbsp;</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div>','Hello,\r\n\r\n\r\nUnable to upgrade “[SITE_NAME]” to Joomla!™ [NEW_VERSION]\r\n\r\n\r\nPanopticon was unable to install the new Joomla! version [NEW_VERSION] on \r\nyour site “[SITE_NAME]”. The error received is as follows:\r\n\r\n\r\n[MESSAGE]\r\n\r\n\r\n==============================================================================\r\n! ! ! ! !  ACTION REQUIRED  ! ! ! ! !\r\n==============================================================================\r\n\r\nThe new version will NOT be installed automatically. You will have to\r\ninstall it yourself.\r\n\r\n==============================================================================\r\n\r\n\r\nYou can install the new Joomla! version either from your site\'s\r\nadministrator page, or through the main control panel of your Akeeba\r\nPanopticon installation ([URL]).\r\n\r\nHave a great day!\r\n\r\n------------------------------------------------------------------------------\r\n\r\nThis email was sent by the Panopticon installation on [URL].\r\nThis is an automated email. Please do not reply to it.');
]]></query>
        </action>

        <!-- Install mail template: akeebabackup_success -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'akeebabackup_success') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates` (`type`, `language`, `subject`, `html`, `plaintext`) VALUES ('akeebabackup_success', '*', 'Successful backup on “[SITE_NAME]”', '<div class="akemail-outer-wrapper">
<table>
<tbody>
<tr>
<td width="10%">&nbsp;</td>
<td>
<div class="akemail-wrapper">
<div class="akemail-container"><!-- Logo Header -->
<div class="akemail-logo"><a href="[URL]">&nbsp;<img src="[URL]/media/images/logo_bw.svg" alt="Panopticon &mdash; Site Monitoring">&nbsp;</a></div>
<!-- Hello -->
<div class="akemail-hello">
<p>Hello,</p>
</div>
<!-- Main-Topic -->
<div class="akemail-main-topic">
<p>A backup on &ldquo;[SITE_NAME]&rdquo; completed successfully</p>
</div>
<!-- Message -->
<div class="akemail-message">
<p>The backup on &ldquo;[SITE_NAME]&rdquo; with profile #[PROFILE_ID] has completed successfully.</p>
<p>No further action is required on your part.</p>
</div>
<!-- Area Offer/Announcement --><!-- Bye, Bye -->
<div class="akemail-outro">
<p>Have a great day!</p>
</div>
<!-- Footer -->
<div class="akemail-footer">
<p class="akemail-footer-sitelink">&nbsp;<a href="[URL]">Panopticon &mdash; Site Monitoring</a></p>
</div>
</div>
<!-- Legal info -->
<div class="akemail-legalinfo">
<p>This is an automated email. Please do not reply to it.</p>
</div>
</div>
</td>
<td width="10%">&nbsp;</td>
</tr>
</tbody>
</table>
</div>', 'Hello,


A backup on “[SITE_NAME]” completed successfully


The backup on “[SITE_NAME]” with profile #[PROFILE_ID] has
completed successfully.

No further action is required on your part.


Have a great day!

------------------------------------------------------------------------------

This email was sent by the Panopticon installation on [URL]
This is an automated email. Please do not reply to it.')
]]></query>
        </action>

        <!-- Install mail template: akeebabackup_fail -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'akeebabackup_fail') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates` (`type`, `language`, `subject`, `html`, `plaintext`) VALUES ('akeebabackup_fail', '*', 'Failed backup on “[SITE_NAME]”', '<div class="akemail-outer-wrapper">
            <table>
                <tbody>
                    <tr>
                        <td width="10%">&nbsp;</td>
                        <td>
                            <div class="akemail-wrapper">
                                <div class="akemail-container"><!-- Logo Header -->
                                    <div class="akemail-logo"><a href="[URL]">&nbsp;<img src="[URL]/media/images/logo_bw.svg" alt="Panopticon &mdash; Site Monitoring">&nbsp;</a></div>
                                    <!-- Hello -->
                                    <div class="akemail-hello">
                                        <p>Hello,</p>
                                    </div>
                                    <!-- Main-Topic -->
                                    <div class="akemail-main-topic">
                                        <p>A backup on &ldquo;[SITE_NAME]&rdquo; failed to complete.</p>
                                    </div>
                                    <!-- Message -->
                                    <div class="akemail-message">
                                        <p>The backup on &ldquo;[SITE_NAME]&rdquo; with profile #[PROFILE_ID] failed to complete. The error received is:</p>
                                        <p>[MESSAGE]</p>
                                    </div>
                                    <!-- Area Offer/Announcement --><!-- Bye, Bye -->
                                    <div class="akemail-outro">
                                        <p>Have a great day!</p>
                                    </div>
                                    <!-- Footer -->
                                    <div class="akemail-footer">
                                        <p class="akemail-footer-sitelink">&nbsp;<a href="[URL]">Panopticon &mdash; Site Monitoring</a></p>
                                    </div>
                                </div>
                                <!-- Legal info -->
                                <div class="akemail-legalinfo">
                                    <p>This is an automated email. Please do not reply to it.</p>
                                </div>
                            </div>
                        </td>
                        <td width="10%">&nbsp;</td>
                    </tr>
                </tbody>
            </table>
        </div>', 'Hello,


            A backup on “[SITE_NAME]” failed to complete.


            The backup on “[SITE_NAME]” with profile #[PROFILE_ID] failed to complete.
            The error received is:

            [MESSAGE]


            Have a great day!

            ------------------------------------------------------------------------------

            This email was sent by the Panopticon installation on [URL]
            This is an automated email. Please do not reply to it.');
]]></query>
        </action>

        <!-- Install mail template: extensions_update_done -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'extensions_update_done') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO panopticon.#__mailtemplates (type, language, subject, html, plaintext) VALUES ('extensions_update_done', '*', 'Automatic extension updates on [SITE_NAME]', '<div class="akemail-outer-wrapper">\n<table>\n<tbody>\n<tr>\n<td width="10%">&nbsp;</td>\n<td>\n<div class="akemail-wrapper">\n<div class="akemail-container"><!-- Logo Header -->\n<div class="akemail-logo"><a href="[URL]">&nbsp;<img src="[URL]/media/images/logo_bw.svg" alt="Panopticon &mdash; Site Monitoring">&nbsp;</a></div>\n<!-- Hello -->\n<div class="akemail-hello">\n<p>Hello,</p>\n</div>\n[RENDERED_HTML] <!-- Bye, Bye -->\n<div class="akemail-outro">\n<p>Have a great day!</p>\n</div>\n<!-- Footer -->\n<div class="akemail-footer">\n<p class="akemail-footer-sitelink">&nbsp;<a href="[URL]">Panopticon &mdash; Site Monitoring</a></p>\n</div>\n</div>\n<!-- Legal info -->\n<div class="akemail-legalinfo">\n<p>This is an automated email. Please do not reply to it.</p>\n</div>\n</div>\n</td>\n<td width="10%">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</div>', 'Hello,\n\n\n[RENDERED_TEXT]\n\n\nHave a great day!\n\n------------------------------------------------------------------------------\n\nThis email was sent by the Panopticon installation on [URL]\nThis is an automated email. Please do not reply to it.')
]]></query>
            <query><![CDATA[
INSERT INTO panopticon.#__mailtemplates (type, language, subject, html, plaintext) VALUES ('extension_update_found', '*', '⚠️ [EXTENSION_NAME] [NEW_VERSION] is available for installation on “[SITE_NAME]”', '<div class="akemail-outer-wrapper">\n<table>\n<tbody>\n<tr>\n<td width="10%">&nbsp;</td>\n<td>\n<div class="akemail-wrapper">\n<div class="akemail-container"><!-- Logo Header -->\n<div class="akemail-logo"><a href="[URL]">&nbsp;<img src="[URL]/media/images/logo_bw.svg" alt="Panopticon &mdash; Site Monitoring">&nbsp;</a></div>\n<!-- Hello -->\n<div class="akemail-hello">\n<p>Hello,</p>\n</div>\n<!-- Main-Topic -->\n<div class="akemail-main-topic">\n<p>[EXTENSION_NAME] [NEW_VERSION] is available on &ldquo;[SITE_NAME]&rdquo;</p>\n</div>\n<!-- Message -->\n<div class="akemail-message">\n<p>[EXTENSION_NAME] version [NEW_VERSION] is now available for installation on your site &ldquo;<a href="[SITE_URL]">[SITE_NAME]</a>&rdquo;. Your site is currently running the older version [OLD_VERSION].</p>\n</div>\n<!-- Area Offer/Announcement -->\n<div class="akemail-announcement">\n<div class="akemail-announcement-box">\n<h3>Action required</h3>\n<p>The new version will <strong>NOT</strong> be installed automatically. You will have to install it yourself.</p>\n</div>\n<p class="akemail-announcement-note"><em>Note</em>: Akeeba Panopticon can be configured to install new versions of [EXTENSION_NAME] automatically.</p>\n<p class="akemail-announcement-visitlink">You can install the new [EXTENSION_NAME] version either from your site\'s administrator page, or through the main control panel of <a href="[URL]">your Akeeba Panopticon installation</a>.</p>\n</div>\n<!-- Bye, Bye -->\n<div class="akemail-outro">\n<p>Have a great day!</p>\n</div>\n<!-- Footer -->\n<div class="akemail-footer">\n<p class="akemail-footer-sitelink">&nbsp;<a href="[URL]">Panopticon &mdash; Site Monitoring</a></p>\n</div>\n</div>\n<!-- Legal info -->\n<div class="akemail-legalinfo">\n<p>This is an automated email. Please do not reply to it.</p>\n</div>\n</div>\n</td>\n<td width="10%">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</div>', 'Hello,\n\n\n[EXTENSION_NAME] [NEW_VERSION] is available on “[SITE_NAME]”\n\n\n[EXTENSION_NAME] version [NEW_VERSION] is now available for installation on\nyour site “[SITE_NAME] [SITE_URL]”. Your site is currently\nrunning the older version [OLD_VERSION].\n\n\n==============================================================================\n! ! ! ! !  ACTION REQUIRED  ! ! ! ! !\n==============================================================================\n\nThe new version will NOT be installed automatically. You will have to\ninstall it yourself.\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nNote: Akeeba Panopticon can be configured to install new versions of\n[EXTENSION_NAME] automatically.\n\n==============================================================================\n\n\nYou can install the new [EXTENSION_NAME] version either from\nyour site\'s administrator page, or through the main control panel of your\nAkeeba Panopticon installation ([URL]).\n\nHave a great day!\n\n------------------------------------------------------------------------------\n\nThis email was sent by the Panopticon installation on [URL].\nThis is an automated email. Please do not reply to it.\n')
]]></query>
        </action>

        <!-- Install mail template: selfupdate_found -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'selfupdate_found') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO panopticon.#__mailtemplates (type, language, subject, html, plaintext) VALUES ('selfupdate_found', '*', '✨ Panopticon [NEW_VERSION] is now available', '<div class="akemail-outer-wrapper">\n	<table>\n		<tbody>\n		<tr>\n			<td width="10%">&nbsp;</td>\n			<td>\n				<div class="akemail-wrapper">\n					<div class="akemail-container"><!-- Logo Header -->\n						<div class="akemail-logo"><a href="[URL]">&nbsp;<img src="[URL]/media/images/logo_bw.svg" alt="Panopticon &mdash; Site Monitoring">&nbsp;</a></div>\n						<!-- Hello -->\n						<div class="akemail-hello">\n							<p>Hello,</p>\n						</div>\n						<!-- Main-Topic -->\n						<div class="akemail-main-topic">\n							<p>Akeeba Panopticon [NEW_VERSION] is available</p>\n						</div>\n						<!-- Message -->\n						<div class="akemail-message">\n							<p>Akeeba Panopticon version [NEW_VERSION] is now available for installation. You are currently running the older version [OLD_VERSION].</p>\n						</div>\n						<!-- Area Offer/Announcement -->\n						<div class="akemail-announcement">\n							<div class="akemail-announcement-box">\n								<h3>Action required</h3>\n								<p>Panopticon does not update itself automatically. It\'s up to you to choose when is the best time to update it.</p>\n							</div>\n						</div>\n						<!-- Bye, Bye -->\n						<div class="akemail-outro">\n							<p>Have a great day!</p>\n						</div>\n						<!-- Footer -->\n						<div class="akemail-footer">\n							<p class="akemail-footer-sitelink">&nbsp;<a href="[URL]">Panopticon &mdash; Site Monitoring</a></p>\n						</div>\n					</div>\n					<!-- Legal info -->\n					<div class="akemail-legalinfo">\n						<p>This is an automated email. Please do not reply to it.</p>\n					</div>\n				</div>\n			</td>\n			<td width="10%">&nbsp;</td>\n		</tr>\n		</tbody>\n	</table>\n</div>', 'Hello,\n\n\nAkeeba Panopticon [NEW_VERSION] is available\n\n\nAkeeba Panopticon version [NEW_VERSION] is now available for installation. \nYou are currently running the older version [OLD_VERSION].\n\n==============================================================================\n! ! ! ! !  ACTION REQUIRED  ! ! ! ! !\n==============================================================================\n\nPanopticon does not update itself automatically. It\'s up to you to choose when\nis the best time to update it.\n\n==============================================================================\n\nHave a great day!\n\n------------------------------------------------------------------------------\n\nThis email was sent by the Panopticon installation on [URL].\nThis is an automated email. Please do not reply to it.\n');
]]></query>
        </action>

        <!-- Install mail template: scheduled_update_summary -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'scheduled_update_summary') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates` (`type`, `language`, `subject`, `html`, `plaintext`)
VALUES
	('scheduled_update_summary', '*', 'Updates summary for [SITE_NAME]', '<div class=\"akemail-outer-wrapper\">\r\n<table>\r\n<tbody>\r\n<tr>\r\n<td width=\"10%\">&nbsp;</td>\r\n<td>\r\n<div class=\"akemail-wrapper\">\r\n<div class=\"akemail-container\"><!-- Logo Header -->\r\n<div class=\"akemail-logo\"><a href=\"[URL]\">&nbsp;<img src=\"[URL]/media/images/logo_bw.svg\" alt=\"Panopticon &mdash; Site Monitoring\">&nbsp;</a></div>\r\n<!-- Hello -->\r\n<div class=\"akemail-hello\">\r\n<p>Hello,</p>\r\n</div>\r\n[RENDERED_HTML] <!-- Bye, Bye -->\r\n<div class=\"akemail-outro\">\r\n<p>Have a great day!</p>\r\n</div>\r\n<!-- Footer -->\r\n<div class=\"akemail-footer\">\r\n<p class=\"akemail-footer-sitelink\">&nbsp;<a href=\"[URL]\">Panopticon &mdash; Site Monitoring</a></p>\r\n</div>\r\n</div>\r\n<!-- Legal info -->\r\n<div class=\"akemail-legalinfo\">\r\n<p>This is an automated email. Please do not reply to it.</p>\r\n</div>\r\n</div>\r\n</td>\r\n<td width=\"10%\">&nbsp;</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div>', 'Hello,\r\n\r\n\r\n[RENDERED_TEXT]\r\n\r\n\r\nHave a great day!\r\n\r\n------------------------------------------------------------------------------\r\n\r\nThis email was sent by the Panopticon installation on [URL]\r\nThis is an automated email. Please do not reply to it.');
]]></query>
        </action>

        <!-- Install mail template: ssl_tls_expiring -->
        <action table="#__mailtemplates" canfail="1">
            <condition type="equals" operator="not" value="1"><![CDATA[
SELECT IF(myCount >= 1, 1, 0) AS `condition` FROM (SELECT COUNT(*) AS `myCount` FROM `#__mailtemplates` WHERE `type` = 'ssl_tls_expiring') x
            ]]></condition>
            <query><![CDATA[
INSERT INTO `#__mailtemplates` (`type`, `language`, `subject`, `html`, `plaintext`)
VALUES
	('ssl_tls_expiring', '*', '⚠️ The SSL/TLS certificate for [SITE_NAME] expires soon', '<div class=\"akemail-outer-wrapper\">\r\n<table>\r\n<tbody>\r\n<tr>\r\n<td width=\"10%\">&nbsp;</td>\r\n<td>\r\n<div class=\"akemail-wrapper\">\r\n<div class=\"akemail-container\"><!-- Logo Header -->\r\n<div class=\"akemail-logo\"><a href=\"[URL]\">&nbsp;<img src=\"[URL]/media/images/logo_bw.svg\" alt=\"Panopticon &mdash; Site Monitoring\">&nbsp;</a></div>\r\n<!-- Hello -->\r\n<div class=\"akemail-hello\">\r\n<p>Hello,</p>\r\n</div>\r\n<!-- Main-Topic -->\r\n<div class=\"akemail-main-topic\">\r\n<p>The SSL/TLS certificate for &ldquo;[SITE_NAME]&rdquo; expires soon</p>\r\n</div>\r\n<!-- Message -->\r\n<div class=\"akemail-message\">\r\n<p>The SSL/TLS (HTTPS) certificate for your site &ldquo;<a href=\"[SITE_URL]\">[SITE_NAME]</a>&rdquo; will expire soon, on [DATE]. Please install a new certificate to prevent connectivity problems to your site.</p>\r\n<p><strong>ℹ️ Kind reminder</strong>: If you let your certificate expire, web browsers will report your site as &ldquo;untrusted&rdquo;. Some browsers may prevent your site\'s visitors from accessing your site completely.</p>\r\n</div>\r\n<!-- Area Offer/Announcement -->\r\n<div class=\"akemail-announcement\">\r\n<div class=\"akemail-announcement-box\">\r\n<h3>Action required</h3>\r\n<p>You need to install a new SSL/TLS certificate on your site.</p>\r\n</div>\r\n<p class=\"akemail-announcement-note\"><em>Note</em>: Akeeba Panopticon cannot install or update SSL/TLS certificates. This is something you need to do from your hosting control panel.</p>\r\n</div>\r\n<div class=\"akemail-outro\">\r\n<p>Have a great day!</p>\r\n</div>\r\n<!-- Footer -->\r\n<div class=\"akemail-footer\">\r\n<p class=\"akemail-footer-sitelink\">&nbsp;<a href=\"[URL]\">Panopticon &mdash; Site Monitoring</a></p>\r\n</div>\r\n</div>\r\n<!-- Legal info -->\r\n<div class=\"akemail-legalinfo\">\r\n<p>This is an automated email. Please do not reply to it.</p>\r\n</div>\r\n</div>\r\n</td>\r\n<td width=\"10%\">&nbsp;</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div>', 'Hello,\r\n\r\n\r\nThe SSL/TLS certificate for “[SITE_NAME]” expires soon\r\n\r\n\r\nThe SSL/TLS (HTTPS) certificate for your site “[SITE_NAME]”\r\nat [SITE_URL]” will expire soon, on [DATE]. Please install a new\r\ncertificate to prevent connectivity problems to your site.\r\n\r\nℹ️ KIND REMINDER: If you let your certificate expire, web browsers\r\nwill report your site as “untrusted”. Some browsers may prevent\r\nyour site\'s visitors from accessing your site completely.\r\n\r\n==============================================================================\r\n! ! ! ! !  ACTION REQUIRED  ! ! ! ! !\r\n==============================================================================\r\n\r\nYou need to install a new SSL/TLS certificate on your site.\r\n\r\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n_Note_: Akeeba Panopticon cannot install or update SSL/TLS\r\ncertificates. This is something you need to do from your hosting\r\ncontrol panel.\r\n\r\n==============================================================================\r\n\r\nHave a great day!\r\n\r\n------------------------------------------------------------------------------\r\n\r\nThis email was sent by the Panopticon installation on [URL]\r\nThis is an automated email. Please do not reply to it.');
]]></query>
        </action>

    </sql>
</schema>