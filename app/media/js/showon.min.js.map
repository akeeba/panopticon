{"version":3,"file":"showon.min.js","names":["akeeba","Showon","a","cont","c","_classCallCheck","self","container","document","fields","showonFields","slice","call","querySelectorAll","length","forEach","field","hasAttribute","setAttribute","localFields","jsondata","getAttribute","showonData","JSON","parse","concat","origin","targets","cField","indexOf","push","value","index","linkedOptions","bind","Object","keys","key","elem","addEventListener","_createClass","b","itemval","elementShowonDatas","showfield","elementShowonData","condition","valid","originField","name","replace","originId","id","includes","toLowerCase","checked","getElementById","nodeName","Array","from","map","el","tagName","_typeof","val","sign","values","op","disabled","classList","remove","dispatchEvent","CustomEvent","bubbles","add","initialise","window"],"sources":["showon.js"],"sourcesContent":["/*\n * @package   panopticon\n * @copyright Copyright (c)2023-2023 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   GNU General Public License version 3, or later\n */\n\nif (typeof akeeba === \"undefined\")\n{\n    var akeeba = {};\n}\n\n/**\n * Uses Joomla's ShowOn field behaviour with the following copyright notice:\n *\n * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>\n * @license    GNU General Public License version 2 or later; see LICENSE.txt\n */\nclass Showon\n{\n    /**\n     * Constructor\n     *\n     * @param {HTMLElement} cont Container element\n     */\n    constructor(cont)\n    {\n        const self     = this;\n        this.container = cont || document;\n        this.fields    = {\n            // origin-field-name: {\n            //   origin:  ['collection of all the trigger nodes'],\n            //   targets: ['collection of nodes to be controlled control']\n            // }\n        };\n\n        this.showonFields = [].slice.call(this.container.querySelectorAll(\"[data-showon]\"));\n        // Populate the fields data\n        if (this.showonFields.length)\n        {\n            // @todo refactor this, dry\n            this.showonFields.forEach((field) =>\n            {\n                // Set up only once\n                if (field.hasAttribute(\"data-showon-initialised\"))\n                {\n                    return;\n                }\n                field.setAttribute(\"data-showon-initialised\", \"\");\n\n                const jsondata   = field.getAttribute(\"data-showon\") || \"\";\n                const showonData = JSON.parse(jsondata);\n                let localFields;\n\n                if (showonData.length)\n                {\n                    localFields =\n                        [].slice.call(self.container.querySelectorAll(\n                            `[name=\"${showonData[0].field}\"], [name=\"${showonData[0].field}[]\"]`));\n\n                    if (!this.fields[showonData[0].field])\n                    {\n                        this.fields[showonData[0].field] = {\n                            origin: [], targets: [],\n                        };\n                    }\n\n                    // Add trigger elements\n                    localFields.forEach((cField) =>\n                    {\n                        if (this.fields[showonData[0].field].origin.indexOf(cField) === -1)\n                        {\n                            this.fields[showonData[0].field].origin.push(cField);\n                        }\n                    });\n\n                    // Add target elements\n                    this.fields[showonData[0].field].targets.push(field);\n\n                    // Data showon can have multiple values\n                    if (showonData.length > 1)\n                    {\n                        showonData.forEach((value, index) =>\n                        {\n                            if (index === 0)\n                            {\n                                return;\n                            }\n\n                            localFields =\n                                [].slice.call(self.container.querySelectorAll(\n                                    `[name=\"${value.field}\"], [name=\"${value.field}[]\"]`));\n\n                            if (!this.fields[showonData[0].field])\n                            {\n                                this.fields[showonData[0].field] = {\n                                    origin: [], targets: [],\n                                };\n                            }\n\n                            // Add trigger elements\n                            localFields.forEach((cField) =>\n                            {\n                                if (this.fields[showonData[0].field].origin.indexOf(cField) === -1)\n                                {\n                                    this.fields[showonData[0].field].origin.push(cField);\n                                }\n                            });\n\n                            // Add target elements\n                            if (this.fields[showonData[0].field].targets.indexOf(field) === -1)\n                            {\n                                this.fields[showonData[0].field].targets.push(field);\n                            }\n                        });\n                    }\n                }\n            });\n\n            // Do some binding\n            this.linkedOptions = this.linkedOptions.bind(this);\n\n            // Attach events to referenced element, to check condition on change and keyup\n            Object.keys(this.fields).forEach((key) =>\n            {\n                if (this.fields[key].origin.length)\n                {\n                    this.fields[key].origin.forEach((elem) =>\n                    {\n                        // Initialize the showon behaviour for the given HTMLElement\n                        self.linkedOptions(key);\n\n                        // Setup listeners\n                        elem.addEventListener(\"change\", () =>\n                        {\n                            self.linkedOptions(key);\n                        });\n                        elem.addEventListener(\"keyup\", () =>\n                        {\n                            self.linkedOptions(key);\n                        });\n                        elem.addEventListener(\"click\", () =>\n                        {\n                            self.linkedOptions(key);\n                        });\n                    });\n                }\n            });\n        }\n    }\n\n    /**\n     *\n     * @param key\n     */\n    linkedOptions(key)\n    {\n        // Loop through the elements that need to be either shown or hidden\n        this.fields[key].targets.forEach((field) =>\n        {\n            const elementShowonDatas = JSON.parse(field.getAttribute(\"data-showon\")) || [];\n            let showfield            = true;\n            let itemval;\n\n            // Check if target conditions are satisfied\n            elementShowonDatas.forEach((elementShowonData, index) =>\n            {\n                const condition = elementShowonData || {};\n                condition.valid = 0;\n\n                // Test in each of the elements in the field array if condition is valid\n                this.fields[key].origin.forEach((originField) =>\n                {\n                    if (originField.name.replace(\"[]\", \"\") !== elementShowonData.field)\n                    {\n                        return;\n                    }\n\n                    const originId = originField.id;\n\n                    // If checkbox or radio box the value is read from properties\n                    if (originField.getAttribute(\"type\") && [\"checkbox\", \"radio\"].includes(\n                        originField.getAttribute(\"type\").toLowerCase()))\n                    {\n                        if (!originField.checked)\n                        {\n                            // Unchecked fields will return a blank and so always match\n                            // a != condition so we skip them\n                            return;\n                        }\n\n                        itemval = document.getElementById(originId).value;\n                    }\n                    else if (originField.nodeName === \"SELECT\" && originField.hasAttribute(\"multiple\"))\n                    {\n                        itemval = Array.from(originField.querySelectorAll(\"option:checked\")).map((el) => el.value);\n                    }\n                    else\n                    {\n                        // Select lists, text-area etc. Note that multiple-select list returns\n                        // an Array here s0 we can always treat 'itemval' as an array\n                        itemval = document.getElementById(originId).value;\n                        // A multi-select <select> $field  will return null when no elements are\n                        // selected so we need to define itemval accordingly\n                        if (itemval === null && originField.tagName.toLowerCase() === \"select\")\n                        {\n                            itemval = [];\n                        }\n                    }\n\n                    // Convert to array to allow multiple values in the field (e.g. type=list multiple)\n                    // and normalize as string\n                    if (!(typeof itemval === \"object\"))\n                    {\n                        itemval = JSON.parse(`[\"${itemval}\"]`);\n                    }\n\n                    // Test if any of the values of the field exists in showon conditions\n                    itemval.forEach((val) =>\n                    {\n                        // \":\" Equal to one or more of the values condition\n                        if (condition.sign === \"=\" && condition.values.indexOf(val) !== -1)\n                        {\n                            condition.valid = 1;\n                        }\n                        // \"!:\" Not equal to one or more of the values condition\n                        if (condition.sign === \"!=\" && condition.values.indexOf(val) === -1)\n                        {\n                            condition.valid = 1;\n                        }\n                    });\n                });\n\n                // Verify conditions\n                // First condition (no operator): current condition must be valid\n                if (condition.op === \"\")\n                {\n                    if (condition.valid === 0)\n                    {\n                        showfield = false;\n                    }\n                }\n                else\n                {\n                    // Other conditions (if exists)\n                    // AND operator: both the previous and current conditions must be valid\n                    if (condition.op === \"AND\" && condition.valid + elementShowonDatas[index - 1].valid < 2)\n                    {\n                        showfield       = false;\n                        condition.valid = 0;\n                    }\n                    // OR operator: one of the previous and current conditions must be valid\n                    if (condition.op === \"OR\" && condition.valid + elementShowonDatas[index - 1].valid > 0)\n                    {\n                        showfield       = true;\n                        condition.valid = 1;\n                    }\n                }\n            });\n\n            // If conditions are satisfied show the target field(s), else hide\n            if (field.tagName !== \"option\")\n            {\n                if (showfield)\n                {\n                    field.classList.remove(\"d-none\");\n                    field.dispatchEvent(new CustomEvent(\"akeeba:showon-show\", {\n                        bubbles: true,\n                    }));\n                }\n                else\n                {\n                    field.classList.add(\"d-none\");\n                    field.dispatchEvent(new CustomEvent(\"akeeba:showon-hide\", {\n                        bubbles: true,\n                    }));\n                }\n            }\n            else\n            {\n                // @todo: If chosen or choices.js is active we should update them\n                field.disabled = !showfield;\n            }\n        });\n    }\n}\n\n// Provide a public API\nif (!akeeba.Showon)\n{\n    akeeba.Showon = {\n        initialise: (container) => new Showon(container),\n    };\n}\n\n/**\n * Initialize 'showon' feature at an initial page load\n */\nwindow.addEventListener('DOMContentLoaded', () =>{\n    akeeba.Showon.initialise(document);\n});"],"mappings":"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"}